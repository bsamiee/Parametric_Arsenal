root = true
dotnet_code_quality.api_surface = public, internal, private

# ====================================================================
# GLOBAL DEFAULTS
# ====================================================================
[*]
end_of_line = lf
insert_final_newline = true
charset = utf-8
trim_trailing_whitespace = true

# ====================================================================
# C# 12 LANGUAGE FEATURES & MODERN PATTERNS
# ====================================================================
[*.cs]

# --- CORE LANGUAGE FEATURES ---
csharp_style_namespace_declarations = file_scoped:error
dotnet_style_namespace_match_folder = true:error
dotnet_style_require_accessibility_modifiers = always:error
csharp_using_directive_placement = outside_namespace:error
dotnet_sort_system_directives_first = true:error
dotnet_separate_import_directive_groups = true:error

# --- STRONG TYPING (No var, explicit types) ---
csharp_style_var_for_built_in_types = false:error
csharp_style_var_when_type_is_apparent = false:error
csharp_style_var_elsewhere = false:error
dotnet_style_predefined_type_for_locals_parameters_members = true:error
dotnet_style_predefined_type_for_member_access = true:error

# --- C# 12 PRIMARY CONSTRUCTORS ---
csharp_style_prefer_primary_constructors = true:error
dotnet_diagnostic.IDE0290.severity = error

# --- C# 12 COLLECTION EXPRESSIONS ---
dotnet_style_prefer_collection_expression = when_types_exactly_match:error
dotnet_diagnostic.IDE0300.severity = error
dotnet_diagnostic.IDE0301.severity = error
dotnet_diagnostic.IDE0302.severity = error
dotnet_diagnostic.IDE0303.severity = error
dotnet_diagnostic.IDE0304.severity = error
dotnet_diagnostic.IDE0305.severity = suggestion

# ====================================================================
# MONADIC & RAILWAY-ORIENTED PROGRAMMING PATTERNS
# ====================================================================

# --- FUNCTIONAL COMPOSITION ---
dotnet_style_qualification_for_field = true:error
dotnet_style_qualification_for_property = true:error
dotnet_style_qualification_for_method = true:error
dotnet_style_qualification_for_event = true:error

# --- PATTERN MATCHING & SWITCH EXPRESSIONS ---
csharp_style_pattern_matching_over_is_with_cast_check = true:error
csharp_style_pattern_matching_over_as_with_null_check = true:error
csharp_style_prefer_switch_expression = true:error
csharp_style_prefer_relational_pattern = true:error
csharp_style_prefer_not_pattern = true:error
csharp_style_prefer_pattern_matching = true:error
csharp_style_prefer_extended_property_pattern = true:error
dotnet_diagnostic.IDE0078.severity = suggestion
dotnet_diagnostic.IDE0260.severity = error

# --- METHOD GROUPS & DELEGATES ---
csharp_style_prefer_method_group_conversion = true:error
csharp_prefer_conditional_delegate_call = true:error

# --- TARGET-TYPED NEW & INFERENCE ---
csharp_style_implicit_object_creation_when_type_is_apparent = true:error
dotnet_diagnostic.IDE0090.severity = error
dotnet_style_prefer_inferred_tuple_names = true:error
dotnet_style_prefer_inferred_anonymous_type_member_names = true:error
csharp_style_deconstructed_variable_declaration = true:error
dotnet_diagnostic.IDE0180.severity = error

# ====================================================================
# PERFORMANCE & ZERO-ALLOCATION PATTERNS
# ====================================================================

# --- IMMUTABILITY & READONLY ---
dotnet_style_readonly_field = true:error
csharp_style_prefer_readonly_struct = true:error
csharp_style_prefer_readonly_record_struct = true:error
csharp_style_prefer_readonly_struct_member = true:error
dotnet_diagnostic.IDE0044.severity = error
dotnet_diagnostic.IDE0250.severity = error
dotnet_diagnostic.IDE0251.severity = error

# --- AGGRESSIVE EXPRESSION-BODIED MEMBERS (Roslynator) ---
csharp_style_expression_bodied_methods = when_on_single_line:error
csharp_style_expression_bodied_properties = when_on_single_line:error
csharp_style_expression_bodied_operators = when_on_single_line:error
csharp_style_expression_bodied_indexers = when_on_single_line:error
csharp_style_expression_bodied_accessors = when_on_single_line:error
csharp_style_expression_bodied_constructors = when_on_single_line:error
dotnet_diagnostic.RCS0027.severity = error

# --- READONLY MEMBER OPTIMIZATION (Meziantou) ---
dotnet_diagnostic.MA0102.severity = error

# --- INDICES & RANGES ---
csharp_style_prefer_index_operator = true:error
csharp_style_prefer_range_operator = true:error

# --- MODERN C# OPTIMIZATIONS ---
csharp_style_throw_expression = true:error
dotnet_style_prefer_auto_properties = true:error
dotnet_style_prefer_is_null_check_over_reference_equality_method = true:error
csharp_prefer_static_local_function = true:error
csharp_prefer_static_anonymous_function = true:error
csharp_style_prefer_record = true:error
csharp_style_prefer_tuple_swap = true:error

# ====================================================================
# ADVANCED PATTERN ENFORCEMENT
# ====================================================================

# --- INITIALIZERS & CONSTRUCTION ---
dotnet_style_prefer_object_initializer = true:error
dotnet_style_prefer_collection_initializer = true:error

# --- SIMPLIFICATIONS ---
dotnet_style_prefer_conditional_expression_over_assignment = true:error
dotnet_style_prefer_conditional_expression_over_return = true:error
dotnet_style_prefer_coalesce_expression = true:error
dotnet_style_null_propagation = true:error
dotnet_style_prefer_simplified_boolean_expressions = true:error
dotnet_style_prefer_simplified_interpolation = true:error
csharp_style_prefer_simple_default_expression = true:error
dotnet_style_prefer_compound_assignment = true:error
dotnet_diagnostic.IDE0004.severity = suggestion

# --- NAMING & DEFAULTS ---
dotnet_style_prefer_nameof_expression = true:error
csharp_style_prefer_default_literal = true:error
csharp_style_prefer_utf8_string_literals = true:error
csharp_style_prefer_named_arguments = true:error
csharp_style_prefer_local_over_anonymous_function = true:error

# ====================================================================
# FORMATTING & STYLE (K&R + MINIMAL VERTICAL SPACE)
# ====================================================================

# --- K&R BRACE STYLE ---
csharp_new_line_before_open_brace = none
csharp_new_line_before_else = false
csharp_new_line_before_catch = false
csharp_new_line_before_finally = false

# --- MINIMAL VERTICAL SPACE ---
dotnet_style_allow_multiple_blank_lines_experimental = false:error
dotnet_style_allow_statement_immediately_after_block_experimental = true:error

# --- COMPACT SPACING ---
csharp_prefer_braces = when_multiline:suggestion
dotnet_style_operator_placement_when_wrapping = end_of_line:error
csharp_preserve_single_line_statements = true
csharp_preserve_single_line_blocks = true
csharp_new_line_between_query_expression_clauses = false

# --- PARENTHESES PREFERENCES ---
dotnet_style_parentheses_in_arithmetic_binary_operators = always_for_clarity:suggestion
dotnet_style_parentheses_in_relational_binary_operators = always_for_clarity:suggestion
dotnet_style_parentheses_in_other_binary_operators = always_for_clarity:suggestion
dotnet_style_parentheses_in_other_operators = never_if_unnecessary:suggestion

# --- SPACING CONTROL ---
csharp_space_after_keywords_in_control_flow_statements = true
csharp_space_between_parentheses = false
csharp_space_after_cast = false
csharp_space_around_binary_operators = before_and_after

# ====================================================================
# INFRASTRUCTURE & ARCHITECTURAL PATTERNS
# ====================================================================

# --- PLUGIN CONSTRAINTS ---
csharp_style_prefer_top_level_statements = false:error

# --- RESOURCE HANDLING ---
csharp_prefer_simple_using_statement = true:error
dotnet_diagnostic.IDE0063.severity = error

# --- CRITICAL QUALITY GATES ---
dotnet_diagnostic.CA1040.severity = warning  # Avoid empty interfaces
dotnet_diagnostic.CA1822.severity = error   # Mark members static when possible
dotnet_diagnostic.CA1852.severity = error   # Seal types when appropriate

# ====================================================================
# ARCHITECTURAL DESIGN DECISIONS
# ====================================================================

# --- DOMAIN MODELING PATTERNS ---
dotnet_diagnostic.CA1034.severity = none  # Nested types provide logical error/domain hierarchies
dotnet_diagnostic.CA1724.severity = none  # Context/Geometry naming is intentional for domain modeling

# --- ANALYZER INTEGRATION (Suppress redundant CA rules covered by specialized analyzers) ---
dotnet_diagnostic.CA1848.severity = none  # Covered by Meziantou.Analyzer performance rules
dotnet_diagnostic.CA1849.severity = none  # Covered by Meziantou.Analyzer async patterns
dotnet_diagnostic.CA1850.severity = none  # Covered by Meziantou.Analyzer HashCode rules
dotnet_diagnostic.CA2000.severity = none  # Better coverage by IDisposableAnalyzers
dotnet_diagnostic.CA2213.severity = none  # Better coverage by IDisposableAnalyzers
dotnet_diagnostic.CA2007.severity = none  # Covered by Microsoft.VisualStudio.Threading.Analyzers

# --- SUPPRESSED RULES ---
dotnet_diagnostic.IDE0011.severity = none  # Allow omitted braces for dense patterns
dotnet_diagnostic.IDE2001.severity = none  # Allow inline variable declarations
dotnet_diagnostic.IDE0047.severity = none  # Parentheses preferences handled above
dotnet_diagnostic.IDE0048.severity = none  # Parentheses preferences handled above
dotnet_diagnostic.IDE0049.severity = none  # Parentheses preferences handled above
dotnet_diagnostic.IDE0050.severity = none  # Parentheses preferences handled above
dotnet_diagnostic.RCS1032.severity = none  # Allow parentheses for clarity in complex expressions

# ====================================================================
# TEST-SPECIFIC SUPPRESSIONS
# ====================================================================

# --- TEST RESOURCE HANDLING ---
[test/**/Results/*.cs]
dotnet_diagnostic.IDISP017.severity = none  # Intentional manual disposal in deferred execution tests
