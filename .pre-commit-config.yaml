# =============================================================================
# Pre-commit Configuration for Parametric Arsenal
# =============================================================================
# This configuration ensures that all commits are validated against:
# - .NET analyzers (Roslynator, Meziantou, IDisposableAnalyzers)
# - .editorconfig settings enforcement
# - Python linting (ruff)
# - Python type checking (mypy, basedpyright)
# - Formatting standards
#
# Install: pre-commit install
# Run manually: pre-commit run --all-files
# =============================================================================

default_language_version:
  python: python3

repos:
  # ---------------------------------------------------------------------------
  # General File Quality Checks (Local)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: check-merge-conflict
        name: Check for merge conflicts
        entry: bash -c 'if git diff --cached | grep -E "^(<<<<<<<|=======|>>>>>>>)"; then echo "Merge conflict markers found"; exit 1; fi'
        language: system
        pass_filenames: false
      
      - id: check-large-files
        name: Check for large files
        entry: bash -c 'for file in "$@"; do size=$(stat -f%z "$file" 2>/dev/null || stat -c%s "$file" 2>/dev/null); if [ "$size" -gt 512000 ]; then echo "File $file is too large (${size} bytes > 500KB)"; exit 1; fi; done' --
        language: system

  # ---------------------------------------------------------------------------
  # .NET Build & Analysis (Analyzers + EditorConfig)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: dotnet-restore
        name: .NET Restore packages
        entry: dotnet restore
        args: ['Parametric_Arsenal.sln']
        language: system
        files: '\.(cs|csproj|sln|props)$'
        pass_filenames: false

      - id: dotnet-build-analyzers
        name: .NET Build with analyzers
        entry: dotnet build
        args:
          - 'Parametric_Arsenal.sln'
          - '--configuration'
          - 'Release'
          - '--no-restore'
          - '-p:EnforceCodeStyleInBuild=true'
          - '-p:TreatWarningsAsErrors=true'
        language: system
        files: '\.(cs|csproj)$'
        pass_filenames: false

      - id: dotnet-format-verify
        name: .NET Format verification
        entry: dotnet format
        args:
          - 'Parametric_Arsenal.sln'
          - '--verify-no-changes'
          - '--verbosity'
          - 'normal'
        language: system
        files: '\.cs$'
        pass_filenames: false

  # ---------------------------------------------------------------------------
  # Python Linting & Formatting (Local - requires ruff in environment)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: ruff-check
        name: Ruff lint Python files
        entry: bash -c 'if command -v ruff >/dev/null 2>&1; then ruff check --fix "$@"; else echo "ruff not found, skipping"; fi' --
        language: system
        types: [python]

      - id: ruff-format
        name: Ruff format Python files
        entry: bash -c 'if command -v ruff >/dev/null 2>&1; then ruff format "$@"; else echo "ruff not found, skipping"; fi' --
        language: system
        types: [python]

  # ---------------------------------------------------------------------------
  # Python Type Checking (Optional - run manually or in CI)
  # ---------------------------------------------------------------------------
  # Note: Type checking is resource-intensive and better suited for CI/manual runs
  # Uncomment these hooks if you want type checking on every commit:
  #
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.18.2
  #   hooks:
  #     - id: mypy
  #       name: Mypy type checking
  #       args:
  #         - '--config-file=pyproject.toml'
  #         - '--cache-dir=.cache/mypy'
  #       types: [python]
  #
  # - repo: local
  #   hooks:
  #     - id: basedpyright
  #       name: Basedpyright type checking
  #       entry: basedpyright
  #       language: system
  #       types: [python]
  #       pass_filenames: false

# =============================================================================
# Configuration
# =============================================================================
ci:
  autofix_commit_msg: 'style: auto-fix pre-commit hooks'
  autofix_prs: true
  autoupdate_commit_msg: 'chore: update pre-commit hooks'
  autoupdate_schedule: monthly
