# =============================================================================
# Pre-commit Configuration for Parametric Arsenal
# =============================================================================
# This configuration ensures that all commits are validated against:
# - .NET analyzers (Roslynator, Meziantou, IDisposableAnalyzers)
# - .editorconfig settings enforcement
# - Python linting (ruff)
# - Formatting standards
#
# Install: pre-commit install
# Run manually: pre-commit run --all-files
#
# IMPORTANT: Pre-commit hooks run FULL solution builds. If there are any
# existing build errors in the solution (even in files not being committed),
# the commit will be blocked. This ensures the entire codebase remains in a
# buildable state. To bypass this check temporarily:
#   git commit --no-verify -m "message"
# =============================================================================

default_language_version:
  python: python3

repos:
  # ---------------------------------------------------------------------------
  # General File Quality Checks (QOL improvements)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
        args: ['--markdown-linebreak-ext=md']
      - id: end-of-file-fixer
        name: Fix end of files (add missing newline)
      - id: mixed-line-ending
        name: Fix mixed line endings (normalize to LF)
        args: ['--fix=lf']
      - id: check-yaml
        name: Check YAML syntax
      - id: check-json
        name: Check JSON syntax
      - id: check-toml
        name: Check TOML syntax
      - id: check-merge-conflict
        name: Check for merge conflict markers
      - id: check-added-large-files
        name: Check for large files (>500KB)
        args: ['--maxkb=500']
      - id: check-case-conflict
        name: Check for case conflicts in filenames
      - id: detect-private-key
        name: Detect private keys (security)
        exclude: '^test/'

  # ---------------------------------------------------------------------------
  # .NET Build & Analysis (Analyzers + EditorConfig)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: dotnet-restore
        name: .NET Restore packages
        entry: dotnet restore
        args: ['Parametric_Arsenal.sln']
        language: system
        files: '\.(cs|csproj|sln|props)$'
        pass_filenames: false

      - id: dotnet-build-analyzers
        name: .NET Build with analyzers
        entry: dotnet build
        args:
          - 'Parametric_Arsenal.sln'
          - '--configuration'
          - 'Release'
          - '--no-restore'
          - '-p:EnforceCodeStyleInBuild=true'
          - '-p:TreatWarningsAsErrors=true'
        language: system
        files: '\.(cs|csproj)$'
        pass_filenames: false

      - id: dotnet-format
        name: .NET Format (auto-fix)
        entry: dotnet format
        args:
          - 'Parametric_Arsenal.sln'
          - '--verbosity'
          - 'normal'
        language: system
        files: '\.cs$'
        pass_filenames: false

  # ---------------------------------------------------------------------------
  # Python Linting & Formatting (Local - requires ruff in environment)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: ruff-check
        name: Ruff lint Python files
        entry: bash -c 'if command -v ruff >/dev/null 2>&1; then ruff check --fix "$@"; else echo "ruff not found, skipping"; fi' --
        language: system
        types: [python]

      - id: ruff-format
        name: Ruff format Python files
        entry: bash -c 'if command -v ruff >/dev/null 2>&1; then ruff format "$@"; else echo "ruff not found, skipping"; fi' --
        language: system
        types: [python]

  # ---------------------------------------------------------------------------
  # Python Type Checking (Optional - run manually or in CI)
  # ---------------------------------------------------------------------------
  # Note: Type checking is resource-intensive and better suited for CI/manual runs
  # Uncomment these hooks if you want type checking on every commit:
  #
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.18.2
  #   hooks:
  #     - id: mypy
  #       name: Mypy type checking
  #       args:
  #         - '--config-file=pyproject.toml'
  #         - '--cache-dir=.cache/mypy'
  #       types: [python]
  #
  # - repo: local
  #   hooks:
  #     - id: basedpyright
  #       name: Basedpyright type checking
  #       entry: basedpyright
  #       language: system
  #       types: [python]
  #       pass_filenames: false

# =============================================================================
# Configuration
# =============================================================================
ci:
  autofix_commit_msg: 'style: auto-fix pre-commit hooks'
  autofix_prs: true
  autoupdate_commit_msg: 'chore: update pre-commit hooks'
  autoupdate_schedule: monthly
