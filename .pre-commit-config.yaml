# =============================================================================
# Pre-commit Configuration for Parametric Arsenal
# =============================================================================
# This configuration ensures that all commits are validated against:
# - .NET analyzers (Roslynator, Meziantou, IDisposableAnalyzers)
# - .editorconfig settings enforcement
# - Python linting (ruff)
# - Python type checking (mypy, basedpyright)
# - Formatting standards
#
# Install: pre-commit install
# Run manually: pre-commit run --all-files
# =============================================================================

default_language_version:
  python: python3

repos:
  # ---------------------------------------------------------------------------
  # General File Quality Checks
  # ---------------------------------------------------------------------------
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
        exclude: '\.md$'
      - id: end-of-file-fixer
        name: Ensure files end with newline
      - id: check-yaml
        name: Validate YAML files
      - id: check-json
        name: Validate JSON files
      - id: check-toml
        name: Validate TOML files
      - id: check-added-large-files
        name: Prevent large files (>500KB)
        args: ['--maxkb=500']
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: check-case-conflict
        name: Check for filename case conflicts
      - id: mixed-line-ending
        name: Ensure consistent line endings
        args: ['--fix=lf']

  # ---------------------------------------------------------------------------
  # .NET Build & Analysis (Analyzers + EditorConfig)
  # ---------------------------------------------------------------------------
  - repo: local
    hooks:
      - id: dotnet-restore
        name: .NET Restore packages
        entry: dotnet restore
        args: ['Parametric_Arsenal.sln']
        language: system
        files: '\.(cs|csproj|sln|props)$'
        pass_filenames: false

      - id: dotnet-build-analyzers
        name: .NET Build with analyzers
        entry: dotnet build
        args:
          - 'Parametric_Arsenal.sln'
          - '--configuration'
          - 'Release'
          - '--no-restore'
          - '-p:EnforceCodeStyleInBuild=true'
          - '-p:TreatWarningsAsErrors=true'
        language: system
        files: '\.(cs|csproj)$'
        pass_filenames: false

      - id: dotnet-format-verify
        name: .NET Format verification
        entry: dotnet format
        args:
          - 'Parametric_Arsenal.sln'
          - '--verify-no-changes'
          - '--verbosity'
          - 'normal'
        language: system
        files: '\.cs$'
        pass_filenames: false

  # ---------------------------------------------------------------------------
  # Python Linting & Formatting (Ruff)
  # ---------------------------------------------------------------------------
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.0
    hooks:
      - id: ruff
        name: Ruff lint Python files
        args: ['--fix', '--exit-non-zero-on-fix']
        types: [python]

      - id: ruff-format
        name: Ruff format Python files
        types: [python]

  # ---------------------------------------------------------------------------
  # Python Type Checking (Optional - run manually or in CI)
  # ---------------------------------------------------------------------------
  # Note: Type checking is resource-intensive and better suited for CI/manual runs
  # Uncomment these hooks if you want type checking on every commit:
  #
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.18.2
  #   hooks:
  #     - id: mypy
  #       name: Mypy type checking
  #       args:
  #         - '--config-file=pyproject.toml'
  #         - '--cache-dir=.cache/mypy'
  #       types: [python]
  #
  # - repo: local
  #   hooks:
  #     - id: basedpyright
  #       name: Basedpyright type checking
  #       entry: basedpyright
  #       language: system
  #       types: [python]
  #       pass_filenames: false

# =============================================================================
# Configuration
# =============================================================================
ci:
  autofix_commit_msg: 'style: auto-fix pre-commit hooks'
  autofix_prs: true
  autoupdate_commit_msg: 'chore: update pre-commit hooks'
  autoupdate_schedule: monthly
